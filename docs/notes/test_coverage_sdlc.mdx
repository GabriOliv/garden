---
sidebar_position: 1
title: Cobertura de Testes
description: Compara√ß√£o entre itera√ß√µes de desenvolvimento com e sem cobertura de testes no ciclo de vida do software
tags: [stageB, notes, qa, test, process, quality_management, unit_testing, manual_testing, test_planning, prevention, quality_assurance, quality_metrics, code_review]
draft: false
---

# Cobertura de Testes

{frontMatter.description}<br />

---

## Entendendo Cobertura de Testes

**Cobertura de testes** √© a porcentagem do c√≥digo-fonte que √© exercida por testes automatizados. Uma cobertura robusta significa que mudan√ßas futuras ser√£o detectadas rapidamente se quebrarem as funcionalidades existentes.

### Por que Importa?

- Reduz regress√µes em 70-90% (Amann & J√ºrgens, 2020)
- Aumenta confian√ßa para refatora√ß√£o
- Documenta comportamento esperado do c√≥digo
- Facilita manuten√ß√£o de c√≥digo legado

### Exemplo Pr√°tico

```python
# C√≥digo sem cobertura
def calcular_desconto(preco, cliente):
	if cliente['tipo'] == 'vip':
		return preco * 0.8
	return preco * 0.9

# Testes unit√°rios que cobrem ambos os cen√°rios
def test_aplica_desconto_vip():
	assert calcular_desconto(100, {'tipo': 'vip'}) == 80

def test_aplica_desconto_comum():
	assert calcular_desconto(100, {'tipo': 'comum'}) == 90
```

---

## Itera√ß√£o de SDLC sem Cobertura de Testes

<figure>
	<figcaption class="text--center">Itera√ß√£o de desenvolvimento sem cobertura de testes[^1]</figcaption>
	![image](./assets/test_coverage_sdlc_without_coverage.svg)
</figure>

1. Software Est√°vel:
	- Ainda n√£o h√° altera√ß√µes inst√°veis (cinza).
2. Processo de Desenvolvimento:
	- Desenvolvedor:
		- Adiciona um novo bloco de c√≥digo ainda sem testes (vermelho).
		- <span style={{color:'var(--ifm-color-danger-darker)'}}>N√ÉO escreve testes para o novo c√≥digo.</span>
	- Rotina de Teste:
		- <span style={{color:'var(--ifm-color-danger-darker)'}}>Testes manuais para verificar o c√≥digo.</span>
		- Desenvolvedor corrige o c√≥digo para que os testes sejam aprovados.
3. Processo de Teste:
	- C√≥digo novo √© testado e bugs s√£o corrigidos.
	- C√≥digo antigo √© testado e bugs s√£o corrigidos.
	- <span style={{color:'var(--ifm-color-danger-darker)'}}>Parte dos bugs √© corrigida, mas n√£o todos, pois n√£o h√° rastreabilidade.</span>
4. Software Ap√≥s Itera√ß√£o:
	- <span style={{color:'var(--ifm-color-danger-darker)'}}>Software com blocos inst√°veis (laranja).</span>
	- Recebe um novo bloco de c√≥digo (vermelho).
	- O processo se repete.

## Itera√ß√£o de SDLC com Cobertura de Testes

<figure>
	<figcaption class="text--center">Itera√ß√£o de desenvolvimento com cobertura de testes[^2]</figcaption>
	![image](./assets/test_coverage_sdlc_with_coverage.svg)
</figure>

1. Software Est√°vel:
	- Ainda n√£o h√° altera√ß√µes inst√°veis (cinza).
	- <span style={{color:'var(--ifm-color-primary)'}}>Alguns blocos do c√≥digo est√£o cobertos por testes (azul).</span>
2. Processo de Desenvolvimento:
	- Desenvolvedor:
		- Adiciona um novo bloco de c√≥digo ainda sem testes (vermelho).
		- <span style={{color:'var(--ifm-color-primary)'}}>Escreve testes para o novo c√≥digo.</span>
	- Rotina de Teste:
		- <span style={{color:'var(--ifm-color-primary)'}}>Executa os testes.</span>
		- <span style={{color:'var(--ifm-color-primary)'}}>Os testes falham e avisam o desenvolvedor (verde).</span>
		- Desenvolvedor corrige o c√≥digo para que os testes sejam aprovados.
3. Processo de Teste:
	- <span style={{color:'var(--ifm-color-primary)'}}>Execu√ß√£o coberta de testes (azul).</span>
	- C√≥digo novo √© testado e bugs s√£o corrigidos.
	- C√≥digo antigo √© testado e bugs s√£o corrigidos.
	- <span style={{color:'var(--ifm-color-primary)'}}>Testes s√£o escritos para os bugs descobertos pelos novos testes (verde).</span>
4. Software Ap√≥s Itera√ß√£o:
	- <span style={{color:'var(--ifm-color-primary)'}}>Software com cobertura de testes est√°vel (azul).</span>
	- Recebe um novo bloco de c√≥digo (vermelho).
	- <span style={{color:'var(--ifm-color-primary)'}}>Novos testes foram escritos para o novo c√≥digo (verde).</span>
	- O processo se repete.

---

## Armadilha: Cobertura vs. Qualidade

> ‚ö†Ô∏è **Alta cobertura ‚â† Testes de qualidade**

Um teste que apenas verifica se a fun√ß√£o executa sem erros √© uma "falsa cobertura".

```python
# ‚ùå Teste que cobre a linha, mas n√£o valida o resultado
def test_executa_calcular_desconto():
	calcular_desconto(100, {'tipo': 'vip'})
	# Sem valida√ß√£o do resultado!

# ‚úÖ Teste de qualidade que valida comportamento
def test_aplica_desconto_correto_para_vip():
	assert calcular_desconto(100, {'tipo': 'vip'}) == 80
	# Valida o resultado esperado
```

Priorize a qualidade sobre a quantidade de linhas cobertas. Um teste ruim √© pior do que nenhum teste.

---

## Implementando Cobertura de Testes

### Fase 1: Diagn√≥stico

- Medir cobertura atual do seu projeto com ferramentas (Jest, Istanbul, Codecov)
- Identificar √°reas cr√≠ticas com baixa cobertura
- Documentar baseline atual

### Fase 2: Prioriza√ß√£o

- Cobrir c√≥digo cr√≠tico primeiro (regras de neg√≥cio, fluxos financeiros)
- Focar no c√≥digo frequentemente alterado
- Ignorar getters e setters triviais

### Fase 3: Itera√ß√£o Gradual

- Aumentar de 5 a 10% de cobertura por ciclo de desenvolvimento
- Exigir testes para todo novo c√≥digo via pull requests
- Revisar a qualidade dos testes, n√£o apenas a porcentagem de cobertura

### Fase 4: Manuten√ß√£o

- Configurar CI/CD para falhar caso a cobertura caia
- Revisar os relat√≥rios de cobertura regularmente
- Educar a equipe sobre falsa cobertura

### Observa√ß√µes Importantes:

- **Execu√ß√£o completa regular**: Mesmo com alta cobertura, execute toda a su√≠te periodicamente
- **Mudan√ßas n√£o-c√≥digo**: Altera√ß√µes em configura√ß√£o, dados ou metadados podem n√£o ser detectadas
- **Cobertura ‚â† Qualidade**: C√≥digo executado 5 vezes mais propenso a erros se n√£o testado adequadamente

---

## Mapa Mental

- üéØ Cobertura de Testes
	- üìä Entendimento - **Por que Importa?**
			- Reduz regress√µes 70%
			- Facilita refatora√ß√£o
			- Documenta comportamento
	- üîÑ Compara√ß√£o SDLC
		- üî¥ **SEM Cobertura**
			- Testes manuais
			- Bugs n√£o rastreados
			- Software inst√°vel
			- D√©bito t√©cnico acumulado
		- üü¢ **COM Cobertura**
			- Testes automatizados
			- Rastreabilidade completa
			- Software est√°vel
			- Cobertura gradual
			- Menos d√©bito t√©cnico
	- ‚ö†Ô∏è Armadilhas - **Falsa Cobertura**
			- Priorize qualidade sobre quantidade
	- üìã Implementa√ß√£o
		1. üîç Diagn√≥stico
		2. üéØ Prioriza√ß√£o
		3. üîÑ Itera√ß√£o
		4. ‚öôÔ∏è Manuten√ß√£o

---

## Refer√™ncias

- Artigo de Refer√™ncia usado para idealizar as imagens:
	- AMANN, Sven; J√úRGENS, Elmar. **Change-Driven Testing**. In: THE FUTURE OF SOFTWARE QUALITY ASSURANCE. 2020. p. 1-14.
		- https://doi.org/10.1007/978-3-030-29509-7_1
		- A forma de diagramar a presen√ßa de erros e cobertura de testes em um sistema foi adaptada em uma nova imagem para demonstrar a diferen√ßa entre o cen√°rio de desenvolvimento com e sem cobertura de testes.

[^1]: Imagem: "Itera√ß√£o de desenvolvimento sem cobertura de testes"
	- Fonte: Diagrama√ß√£o pr√≥pria.
	- Legenda:
		- cinza: c√≥digo est√°vel;
		- laranja: c√≥digo inst√°vel;
		- vermelho: c√≥digo novo que n√£o foi testado.

[^2]: Imagem: "Itera√ß√£o de desenvolvimento com cobertura de testes"
	- Fonte: Diagrama√ß√£o pr√≥pria.
	- Legenda:
		- cinza: c√≥digo est√°vel;
		- laranja: c√≥digo inst√°vel;
		- vermelho: c√≥digo novo que n√£o foi testado;
		- azul: c√≥digo est√°vel coberto por testes;
		- verde: c√≥digo coberto em que os testes falharam e avisaram o desenvolvedor.

---